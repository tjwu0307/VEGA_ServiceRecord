<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¶­å˜‰å…¨çƒç§‘æŠ€ - æœå‹™ç´€éŒ„å–®</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: white;
            min-height: 100vh;
            padding: 15px;
            margin: 0;
        }
        
        .container {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            background: white;
            overflow: hidden;
            page-break-inside: avoid;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
                margin: 0;
            }
            
            .container {
                width: 210mm;
                min-height: 297mm;
                max-width: none;
                border-radius: 0;
                box-shadow: none;
                page-break-inside: avoid;
            }
            
            .submit-section, .clear-btn, .signature-controls {
                display: none !important;
            }
        }
        
        .header {
            background: white;
            color: #333;
            padding: 8mm;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo {
            width: 80px;
            height: auto;
            flex-shrink: 0;
        }
        
        .logo img {
            width: 100%;
            height: auto;
        }
        
        .right-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .company-info {
            text-align: left;
        }
        
        .company-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-title {
            font-size: 20px;
            color: #666;
        }
        
        .contact-info {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        
        .contact-section {
            text-align: left;
            padding: 8px;
            flex: 1;
        }
        
        .contact-section h3 {
            color: #333;
            margin-bottom: 8px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .contact-section p {
            margin: 3px 0;
            color: #333;
            font-size: 10px;
            line-height: 1.2;
        }
        
        .form-content {
            padding: 5mm 10mm;
        }
        
        .form-grid {
            display: table;
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        
        .form-row {
            display: table-row;
        }
        
        .form-cell {
            display: table-cell;
            border: 1px solid #333;
            padding: 8px;
            vertical-align: middle;
        }
        
        .form-cell.label {
            background: #f0f0f0;
            font-weight: bold;
            width: 25%;
            text-align: center;
        }
        
        .form-cell.input {
            width: 25%;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group.full-width {
            grid-column: span 4;
        }
        
        .form-group.half-width {
            grid-column: span 2;
        }
        
        .form-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
            font-size: 12px;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            padding: 4px;
            border: none;
            font-size: 12px;
            width: 100%;
            background: transparent;
        }
        
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            background: #f9f9f9;
        }
        
        .date-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .date-inputs input {
            width: 60px;
            text-align: center;
        }
        
        .time-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .time-inputs input {
            width: 80px;
            text-align: center;
        }
        
        .service-methods {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 14px;
            height: 14px;
        }
        
        .checkbox-group label {
            font-size: 12px;
            margin-bottom: 0;
        }
        
        .product-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border: 1px solid #333;
        }
        
        .product-table th, .product-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #333;
            font-size: 11px;
        }
        
        .product-table th {
            background: #f0f0f0;
            color: #333;
            font-weight: bold;
            font-size: 12px;
        }
        
        .product-table input {
            width: 100%;
            padding: 5px;
            border: none;
            font-size: 11px;
            background: transparent;
            text-align: center;
        }
        
        .section-title {
            background: #f0f0f0;
            padding: 8px;
            border: 1px solid #333;
            border-bottom: none;
            font-weight: bold;
            text-align: left;
            font-size: 16px;
            margin-top: 15px;
        }
        
        .section-content {
            border: 1px solid #333;
            padding: 10px;
            margin-bottom: 15px;
        }
        
        .expense-section {
            border: 1px solid #333;
            margin: 15px 0;
        }
        
        .expense-grid {
            display: flex;
            flex-wrap: wrap;
            width: 100%;
        }
        
        .expense-item {
            flex: 1;
            min-width: 120px;
            display: flex;
            flex-direction: column;
            padding: 8px;
            border-right: 2px solid #333;
            background: #fafafa;
        }
        
        .expense-item:last-child {
            border-right: none;
        }
        
        .expense-item:nth-child(even) {
            background: #f5f5f5;
        }
        
        .expense-item label {
            font-weight: bold;
            font-size: 11px;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .expense-item input {
            padding: 4px;
            border: none;
            font-size: 11px;
            background: transparent;
            text-align: center;
        }
        
        .signature-section {
            display: table;
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            border: 1px solid #333;
        }
        
        .signature-row {
            display: table-row;
        }
        
        .signature-box {
            display: table-cell;
            text-align: center;
            padding: 12px;
            vertical-align: top;
            width: 33.33%;
            position: relative;
            border-right: 1px solid #333;
        }
        
        .signature-box:last-child {
            border-right: none;
        }
        
        .signature-canvas {
            width: 100%;
            height: 80px;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            background: white;
            cursor: crosshair;
        }
        
        .signature-controls {
            position: absolute;
            top: 5px;
            right: 5px;
        }
        
        .clear-btn {
            background: #66B3FF;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s ease;
        }
        
        .clear-btn:hover {
            background: #4A9FFF;
        }
        
        .copy-info {
            background: white;
            padding: 12px;
            text-align: center;
            font-size: 16px;
            color: #333;
        }
        
        .copy-item {
            display: inline;
            margin: 0 20px;
        }
        
        .submit-section {
            text-align: center;
            padding: 20px;
            background: white;
        }
        
        .submit-btn {
            background: linear-gradient(145deg, #FF5151, #E04545);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(255, 81, 81, 0.3);
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            background: linear-gradient(145deg, #E04545, #CC3A3A);
            box-shadow: 0 6px 12px rgba(255, 81, 81, 0.4);
            transform: translateY(-2px);
        }
        
        .status-message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @media (max-width: 768px) {
            .contact-info {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-group.half-width {
                grid-column: span 1;
            }
            
            .service-methods {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .expense-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .signature-section {
                grid-template-columns: 1fr;
            }
        }

    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
const managerPad = new SignaturePad(document.getElementById('managerSignature'));
const engineerPad = new SignaturePad(document.getElementById('engineerSignature'));
const customerPad = new SignaturePad(document.getElementById('customerSignature'));

function clearSignature(id) {
  if (id === 'managerSignature') managerPad.clear();
  if (id === 'engineerSignature') engineerPad.clear();
  if (id === 'customerSignature') customerPad.clear();
    .no-print { display: block; }
.no-print { display: block; }
@media print {
  .no-print { display: none !important; }
}
    </style>

</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <img src="https://vega-global.com/wp-content/uploads/2024/07/Website-Logo-2048x1833-1-1536x1375.png" alt="ç¶­å˜‰å…¨çƒç§‘æŠ€" onerror="this.src=''; this.alt='LOGO'; this.style.display='none';">
            </div>
            <div class="right-section">
                <div class="company-info">
                    <div class="company-name">ç¶­å˜‰å…¨çƒç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸</div>
                    <div class="form-title">æœå‹™ç´€éŒ„å–®</div>
                </div>
                <div class="contact-info">
                    <div class="contact-section">
                        <h3>å°åŒ—</h3>
                        <p>æœå‹™å°ˆç·š: 02-35182883</p>
                        <p>å°åŒ—å¸‚æ¾å±±å€æ°‘ç”Ÿæ±è·¯ä¸‰æ®µ128è™Ÿ14F-1</p>
                        <p>Fax: (02) 2545-1155</p>
                    </div>
                    <div class="contact-section">
                        <h3>å°ä¸­</h3>
                        <p>æœå‹™å°ˆç·š: 02-35182884</p>
                        <p>å°ä¸­å¸‚åŒ—ä¸­å€æ–‡å¿ƒè·¯å››æ®µ81è™Ÿ9æ¨“ä¹‹2</p>
                        <p>Fax: (04) 2295-5833</p>
                    </div>
                    <div class="contact-section">
                        <h3>é«˜é›„</h3>
                        <p>æœå‹™å°ˆç·š: 02-35182885</p>
                        <p>é«˜é›„å¸‚å‰é®å€ä¸­å±±äºŒè·¯91è™Ÿ8æ¨“ä¹‹9</p>
                        <p>Fax: (07) 535-0099</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-content">
            <form id="serviceForm">
                <div class="form-grid">
                    <div class="form-row">
                        <div class="form-cell label">å°ˆæ¡ˆä»£è™Ÿ</div>
                        <div class="form-cell input">
                            <div class="form-group">
                                <input type="text" id="projectCode" name="projectCode">
                            </div>
                        </div>
                        <div class="form-cell label">CRMå®‰è£å–®è™Ÿ</div>
                        <div class="form-cell input">
                            <div class="form-group">
                                <input type="text" id="crmInstallNumber" name="crmInstallNumber">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-cell label">å«ä¿®å–®è™Ÿ</div>
                        <div class="form-cell input">
                            <div class="form-group">
                                <input type="text" id="repairNumber" name="repairNumber">
                            </div>
                        </div>
                        <div class="form-cell label">CRMç¶­ä¿®å–®è™Ÿ</div>
                        <div class="form-cell input">
                            <div class="form-group">
                                <input type="text" id="crmRepairNumber" name="crmRepairNumber">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-cell label">å®¢æˆ¶åç¨±</div>
                        <div class="form-cell input">
                            <div class="form-group">
                                <input type="text" id="customerName" name="customerName">
                            </div>
                        </div>
                             <div class="form-cell label">é€£çµ¡äºº</div>
                        <div class="form-cell input">
                            <div class="form-group">
                                <input type="text" id="contactPerson" name="contactPerson">
                            </div>
                        </div>
                     </div>

                    
                    <div class="form-row">
                        <div class="form-cell label">åœ°å€</div>
                        <div class="form-cell input">
                            <div class="form-group">
                                <input type="text" id="address" name="address">
                            </div>
                        </div>
                        <div class="form-cell label">é›»è©±</div>
                        <div class="form-cell input">
                            <div class="form-group">
                                <input type="text" id="phone" name="phone">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-cell label">æœå‹™æ—¥æœŸ</div>
                        <div class="form-cell input">
                            <div class="form-group">
                                <div class="date-inputs">
                                    <input type="number" id="year" name="year" placeholder="__" min="100" max="200" style="width: 50px;">
                                    <span>å¹´</span>
                                    <input type="number" id="month" name="month" placeholder="__" min="1" max="12" style="width: 40px;">
                                    <span>æœˆ</span>
                                    <input type="number" id="day" name="day" placeholder="__" min="1" max="31" style="width: 40px;">
                                    <span>æ—¥</span>
                        </div>
                        <div class="form-cell label"></div>
                        <div class="form-cell input"></div>
                    </div>
                        <div class="form-cell label">åˆ°é”æ™‚é–“</div>
                        <div class="form-cell input">
                            <div class="form-group">
                                <input type="type" id="arrivalTime" name="arrivalTime">
                            </div>
                        </div>
                        <div class="form-cell label">çµæŸæ™‚é–“</div>
                        <div class="form-cell input">
                            <div class="form-group">
                                <input type="type" id="endTime" name="endTime">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section-title">æœå‹™æ–¹å¼</div>
                <div class="section-content">
                    <div class="service-methods">
                        <div class="checkbox-group">
                            <input type="checkbox" id="survey" name="serviceMethod" value="å ´å‹˜">
                            <label for="survey">å ´å‹˜</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="poc" name="serviceMethod" value="POC">
                            <label for="poc">POC</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="presentation" name="serviceMethod" value="ç°¡å ±">
                            <label for="presentation">ç°¡å ±</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="installation" name="serviceMethod" value="å®‰è£">
                            <label for="installation">å®‰è£</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="acceptance" name="serviceMethod" value="é©—æ”¶">
                            <label for="acceptance">é©—æ”¶</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="maintenance" name="serviceMethod" value="æª¢ä¿®">
                            <label for="maintenance">æª¢ä¿®</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="delivery" name="serviceMethod" value="äº¤è²¨">
                            <label for="delivery">äº¤è²¨</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="interview" name="serviceMethod" value="å®¢æˆ¶éœ€æ±‚è¨ªè«‡">
                            <label for="interview">å®¢æˆ¶éœ€æ±‚è¨ªè«‡</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="demo" name="serviceMethod" value="DEMO ç”¢å“å±•ç¤º">
                            <label for="demo">DEMO ç”¢å“å±•ç¤º</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="training" name="serviceMethod" value="æ•™è‚²è¨“ç·´">
                            <label for="training">æ•™è‚²è¨“ç·´</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="relocation" name="serviceMethod" value="ç§»æ©Ÿæœå‹™">
                            <label for="relocation">ç§»æ©Ÿæœå‹™</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="meeting" name="serviceMethod" value="æœƒè­°æ”¯æ´">
                            <label for="meeting">æœƒè­°æ”¯æ´</label>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <label>å…¶ä»–ï¼š</label>
                        <input type="text" id="otherService" name="otherService" style="margin-left: 10px; width: 300px; border: 1px solid #ccc; padding: 4px;">
                    </div>
                </div>
                
                <div class="section-title">æœå‹™ç”¢å“</div>
                <div class="section-content">
                    <table class="product-table">
                        <thead>
                            <tr>
                                <th>å» ç‰Œ</th>
                                <th>å‹è™Ÿ</th>
                                <th>ç‰ˆæœ¬</th>
                                <th>åºè™Ÿ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="text" name="brand1"></td>
                                <td><input type="text" name="model1"></td>
                                <td><input type="text" name="version1"></td>
                                <td><input type="text" name="serial1"></td>
                            </tr>
                            <tr>
                                <td><input type="text" name="brand2"></td>
                                <td><input type="text" name="model2"></td>
                                <td><input type="text" name="version2"></td>
                                <td><input type="text" name="serial2"></td>
                            </tr>
                            <tr>
                                <td><input type="text" name="brand3"></td>
                                <td><input type="text" name="model3"></td>
                                <td><input type="text" name="version3"></td>
                                <td><input type="text" name="serial3"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="section-title">æœå‹™å…§å®¹</div>
                <div class="section-content">
                    <textarea id="serviceContent" name="serviceContent" rows="5" style="width: 100%; border: none; resize: vertical; background: transparent;"></textarea>
                </div>
                
                <div class="section-title">å®¢æˆ¶æ„è¦‹</div>
                <div class="section-content">
                    <textarea id="customerFeedback" name="customerFeedback" rows="4" style="width: 100%; border: none; resize: vertical; background: transparent;"></textarea>
                </div>
                
                <div class="signature-section">
                    <div class="signature-row">
                        <div class="signature-box">
                            <h4 style="margin-bottom: 15px; color: #333;">ä¸»ç®¡ç°½å</h4>
                            <canvas class="signature-canvas" id="managerSignature"></canvas>
                            <div class="signature-controls">
                                <button type="button" class="clear-btn no-print" onclick="clearSignature('managerSignature')">æ¸…é™¤</button>
                            </div>
                        </div>
                        <div class="signature-box">
                            <h4 style="margin-bottom: 15px; color: #333;">å·¥ç¨‹å¸«ç°½å</h4>
                            <canvas class="signature-canvas" id="engineerSignature"></canvas>
                            <div class="signature-controls">
                                <button type="button" class="clear-btn no-print" onclick="clearSignature('engineerSignature')">æ¸…é™¤</button>
                            </div>
                        </div>
                        <div class="signature-box">
                            <h4 style="margin-bottom: 15px; color: #333;">å®¢æˆ¶ç°½å</h4>
                            <canvas class="signature-canvas" id="customerSignature"></canvas>
                            <div class="signature-controls">
                                <button type="button" class="clear-btn no-print" onclick="clearSignature('customerSignature')">æ¸…é™¤</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="section-title">è²»ç”¨ç”³è«‹ï¼š(ä»¥ä¸‹ç”±å·¥ç¨‹å¸«æ”¶å›å–®æ“šå¾Œå¡«å¯«ç”³è«‹)</div>
                <div class="section-content">
                    <div class="expense-grid">
                        <div class="expense-item">
                            <label>é‡Œç¨‹ (KM)</label>
                            <input type="number" id="mileage" name="mileage" step="0.1">
                        </div>
                        <div class="expense-item">
                            <label>å‡ºç™¼åœ°é»</label>
                            <input type="text" id="departure" name="departure">
                        </div>
                        <div class="expense-item">
                            <label>è¨ˆç¨‹è»Šè³‡</label>
                            <input type="number" id="taxiFee" name="taxiFee">
                        </div>
                        <div class="expense-item">
                            <label>åœè»Šè²»</label>
                            <input type="number" id="parkingFee" name="parkingFee">
                        </div>
                        <div class="expense-item">
                            <label>eTag</label>
                            <input type="number" id="eTag" name="eTag">
                        </div>
                        <div class="expense-item">
                            <label>å¤§çœ¾é‹è¼¸</label>
                            <input type="number" id="publicTransport" name="publicTransport">
                        </div>
                        <div class="expense-item">
                            <label>å…¶ä»–</label>
                            <input type="number" id="otherExpense" name="otherExpense">
                        </div>
                    </div>
                </div>
            </form>
        </div>
        
        <div class="copy-info">
            <span class="copy-item">ç™½è¯ï¼šå·¥ç¨‹å¸«éƒ¨é–€</span>
            <span class="copy-item">ç´…è¯ï¼šè²¡å‹™éƒ¨ï¼ˆè«‹æ¬¾ç”¨ï¼‰</span>
            <span class="copy-item">é»ƒè¯ï¼šå®¢æˆ¶æ”¶åŸ·</span>
        </div>
        
        <div class="submit-section">
            <button type="button" class="submit-btn no-print" onclick="submitForm()">
                ğŸ“„ ç”¢ç”ŸPDFä¸¦é€å‡ºEMAIL
            </button>
            <div id="statusMessage" class="status-message"></div>
        </div>
    </div>

    <script>
        // ç°½ååŠŸèƒ½
        const canvases = ['managerSignature', 'engineerSignature', 'customerSignature'];
        const signatureData = {};
        
        canvases.forEach(canvasId => {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            
            // è¨­ç½®ç•«å¸ƒå¤§å°
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            // è¨­ç½®ç¹ªåœ–æ¨£å¼
            ctx.strokeStyle = '#2c3e50';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            
            // æ»‘é¼ äº‹ä»¶
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // è§¸æ§äº‹ä»¶
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);
            
            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                ctx.beginPath();
                ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            }
            
            function draw(e) {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.stroke();
            }
            
            function stopDrawing() {
                isDrawing = false;
                signatureData[canvasId] = canvas.toDataURL();
            }
            
            function handleTouch(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                                 e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }
        });
        
        function clearSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            delete signatureData[canvasId];
        }
        
        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
        
        async function submitForm() {
            try {
                showStatus('æ­£åœ¨è™•ç†æ‚¨çš„æœå‹™ç´€éŒ„å–®...');
                
                // æ”¶é›†è¡¨å–®è³‡æ–™
                const formData = new FormData(document.getElementById('serviceForm'));
                const data = {};
                
                // åŸºæœ¬è³‡æ–™
                for (let [key, value] = formData.entries()) {
                    data[key] = value;
                }
                
                // æœå‹™æ–¹å¼ï¼ˆå¤šé¸ï¼‰
                const serviceMethods = [];
                document.querySelectorAll('input[name="serviceMethod"]:checked').forEach(cb => {
                    serviceMethods.push(cb.value);
                });
                data.serviceMethods = serviceMethods;
                
                // å…¶ä»–æœå‹™
                if (document.getElementById('otherService').value) {
                    serviceMethods.push('å…¶ä»–ï¼š' + document.getElementById('otherService').value);
                }
                
                // ç”¢å“è³‡æ–™
                data.products = [];
                for (let i = 1; i <= 3; i++) {
                    const brand = document.querySelector(`input[name="brand${i}"]`).value;
                    const model = document.querySelector(`input[name="model${i}"]`).value;
                    const version = document.querySelector(`input[name="version${i}"]`).value;
                    const serial = document.querySelector(`input[name="serial${i}"]`).value;
                    
                    if (brand || model || version || serial) {
                        data.products.push({ brand, model, version, serial });
                    }
                }
                
                // ç°½åè³‡æ–™
                data.signatures = signatureData;
                
                // ç”ŸæˆPDF
                await generatePDF(data);
                
                // æ¨¡æ“¬ç™¼é€åˆ°Google Sheetså’ŒEmail
                await simulateDataSubmission(data);
                
                showStatus('âœ… æœå‹™ç´€éŒ„å–®å·²æˆåŠŸç”¢ç”ŸPDFä¸¦é€å‡ºï¼è³‡æ–™å·²æ›´æ–°è‡³é›²ç«¯è©¦ç®—è¡¨ã€‚');
                
            } catch (error) {
                console.error('æäº¤éŒ¯èª¤:', error);
                showStatus('âŒ æäº¤éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚', true);
            }
        }
        
        async function generatePDF(data) {
            // ä½¿ç”¨ jsPDF ç”Ÿæˆ PDF
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');
            
            // è¨­ç½®ä¸­æ–‡å­—é«”ï¼ˆé€™è£¡ä½¿ç”¨åŸºæœ¬å­—é«”ï¼Œå¯¦éš›æ‡‰ç”¨ä¸­éœ€è¦è¼‰å…¥ä¸­æ–‡å­—é«”ï¼‰
            pdf.setFont('helvetica');
            
            // æ¨™é¡Œ
            pdf.setFontSize(20);
            pdf.text('ç¶­å˜‰å…¨çƒç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸', 105, 30, { align: 'center' });
            pdf.setFontSize(16);
            pdf.text('Service Record Form', 105, 40, { align: 'center' });
            
            // åŸºæœ¬è³‡è¨Š
            let yPos = 60;
            pdf.setFontSize(12);
            
            const fields = [
                ['Project Code', data.projectCode || ''],
                ['Repair Number', data.repairNumber || ''],
                ['Customer Name', data.customerName || ''],
                ['Contact Person', data.contactPerson || ''],
                ['Address', data.address || ''],
                ['Phone', data.phone || ''],
                ['Service Date', `${data.year || ''}-${data.month || ''}-${data.day || ''}`],
                ['Service Methods', data.serviceMethods ? data.serviceMethods.join(', ') : ''],
                ['Service Content', data.serviceContent || ''],
                ['Customer Feedback', data.customerFeedback || '']
            ];
            
            fields.forEach(([label, value]) => {
                pdf.text(`${label}: ${value}`, 20, yPos);
                yPos += 10;
            });
            
            // ç”¢å“è³‡è¨Š
            if (data.products && data.products.length > 0) {
                yPos += 10;
                pdf.text('Products:', 20, yPos);
                yPos += 10;
                
                data.products.forEach((product, index) => {
                    pdf.text(`${index + 1}. Brand: ${product.brand}, Model: ${product.model}, Version: ${product.version}, Serial: ${product.serial}`, 25, yPos);
                    yPos += 8;
                });
            }
            
            // è²»ç”¨è³‡è¨Š
            yPos += 10;
            pdf.text('Expenses:', 20, yPos);
            yPos += 10;
            
            const expenses = [
                ['Mileage', data.mileage || '0'],
                ['Departure', data.departure || ''],
                ['Taxi Fee', data.taxiFee || '0'],
                ['Parking Fee', data.parkingFee || '0'],
                ['eTag', data.eTag || '0'],
                ['Public Transport', data.publicTransport || '0'],
                ['Other', data.otherExpense || '0']
            ];
            
            expenses.forEach(([label, value]) => {
                pdf.text(`${label}: ${value}`, 25, yPos);
                yPos += 8;
            });
            
            // æ¨¡æ“¬ä¸‹è¼‰PDF
            const pdfBlob = pdf.output('blob');
            const url = URL.createObjectURL(pdfBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `service-record-${Date.now()}.pdf`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        async function simulateDataSubmission(data) {
            try {
                // ç™¼é€è³‡æ–™åˆ°Google Apps Script
                const response = await fetch('https://script.google.com/macros/s/AKfycbya6vjHvFLLFUc4Ct4xCuoO1V9LTQVsXFZ1Z4GXcR2eCYh0DrjvSBuozhSNxslAiv2thw/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'submitServiceRecord',
                        data: data,
                        timestamp: new Date().toISOString(),
                        spreadsheet1: 'https://docs.google.com/spreadsheets/d/1Fb2M7vtkOaMr_0DBmeTqwRzeZ19sw7bcN5HRTn3CP9M/edit',
                        spreadsheet2: 'https://docs.google.com/spreadsheets/d/1I_vz6Psk2g_5yOj0sBUlVTquv1RLEJ50xJfTp6wKAWA/edit'
                    })
                });
                
                console.log('è³‡æ–™å·²ç™¼é€åˆ°Google Apps Script');
                return { success: true };
                
            } catch (error) {
                console.error('ç™¼é€åˆ°Google Apps Scriptæ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                // å³ä½¿ç™¼é€å¤±æ•—ï¼Œä»ç„¶å…è¨±PDFç”Ÿæˆ
                return { success: false, error: error.message };
            }
        }
        
        // è‡ªå‹•å¡«å…¥ç•¶å‰æ—¥æœŸ
        window.addEventListener('load', () => {
            const now = new Date();
            const rocYear = now.getFullYear() - 1911; // æ°‘åœ‹å¹´
            
            document.getElementById('year').value = rocYear;
            document.getElementById('month').value = now.getMonth() + 1;
            document.getElementById('day').value = now.getDate();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'979a6b19734af205',t:'MTc1Njk1NjczMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
