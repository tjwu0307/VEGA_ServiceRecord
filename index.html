<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>維嘉全球科技股份有限公司 - 服務紀錄單</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'Microsoft JhengHei', Arial, sans-serif;
      background:white;
    }
    .container {
      width:210mm;
      min-height:297mm;
      margin:0 auto;
      background:white;
      box-sizing:border-box;
      padding:10mm;
    }
    @media print {
      .no-print { display:none !important; }
    }
    .header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }
    .logo { width:80px; }
    .company-info { flex:1; margin-left:10px; }
    .company-name { font-size:20px; font-weight:bold; }
    .form-title { font-size:16px; }
    .contact-info { display:flex; gap:20px; margin-top:8px; }
    .contact-section { font-size:12px; }
    .form-grid {
      display:table;
      width:100%;
      border-collapse:collapse;
      margin-bottom:10px;
    }
    .form-row { display:table-row; }
    .form-cell {
      display:table-cell;
      border:1px solid #333;
      padding:6px;
      vertical-align:middle;
    }
    .form-cell.label { background:#f0f0f0; width:25%; font-weight:bold; text-align:center; }
    .form-cell.input input, .form-cell.input textarea {
      width:100%; border:none; font-size:12px; background:transparent;
    }
    .section-title {
      background:#f0f0f0;
      padding:6px;
      border:1px solid #333;
      border-bottom:none;
      font-weight:bold;
      text-align:left;
      margin-top:10px;
    }
    .section-content {
      border:1px solid #333;
      padding:8px;
      margin-bottom:10px;
    }
    .service-methods {
      display:grid;
      grid-template-columns:repeat(5,1fr);
      gap:6px;
    }
    .checkbox-group { font-size:12px; }
    .product-table {
      width:100%; border-collapse:collapse;
    }
    .product-table th, .product-table td {
      border:1px solid #333; padding:6px; text-align:center; font-size:12px;
    }
    .signature-section {
      display:table; width:100%; border:1px solid #333; margin:10px 0;
    }
    .signature-row { display:table-row; }
    .signature-box {
      display:table-cell; width:33.3%; text-align:center; padding:10px; border-right:1px solid #333; position:relative;
    }
    .signature-box:last-child { border-right:none; }
    .signature-canvas { width:100%; height:80px; border:1px solid #ccc; }
    .signature-controls { position:absolute; top:5px; right:5px; }
    .clear-btn {
      background:#66B3FF; color:white; border:none; padding:4px 8px; cursor:pointer;
    }
    .expense-grid { display:flex; }
    .expense-item { flex:1; border-right:1px solid #333; padding:6px; }
    .expense-item:last-child { border-right:none; }
    .expense-item label { font-weight:bold; font-size:12px; display:block; margin-bottom:4px; }
    .expense-item input { width:100%; border:none; font-size:12px; text-align:center; }
    .copy-info { text-align:center; margin:10px 0; font-size:14px; }
    .submit-section { text-align:center; margin-top:15px; }
    .submit-btn {
      background:#FF5151; color:white; border:none; padding:10px 20px;
      font-weight:bold; border-radius:6px; cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="container" id="pdfContent">
    <div class="header">
      <div class="logo">
        <img src="https://vega-global.com/wp-content/uploads/2024/07/Website-Logo-2048x1833-1-1536x1375.png" width="100%">
      </div>
      <div class="company-info">
        <div class="company-name">維嘉全球科技股份有限公司</div>
        <div class="form-title">服務紀錄單</div>
        <div class="contact-info">
          <div class="contact-section">
            【台北】服務專線 02-35182883<br>
            台北市松山區民生東路三段128號14F-1<br>
            Fax:(02)2545-1155
          </div>
          <div class="contact-section">
            【台中】服務專線 02-35182884<br>
            台中市北中區文心路四段81號9樓之2<br>
            Fax:(04)2295-5833
          </div>
          <div class="contact-section">
            【高雄】服務專線 02-35182885<br>
            高雄市前鎮區中山二路91號8樓之9<br>
            Fax:(07)535-0099
          </div>
        </div>
      </div>
    </div>

    <form id="serviceForm">
      <!-- 專案代號/CRM安裝單號 -->
      <div class="form-grid">
        <div class="form-row">
          <div class="form-cell label">專案代號</div>
          <div class="form-cell input"><input type="text" id="projectCode"></div>
          <div class="form-cell label">CRM安裝單號</div>
          <div class="form-cell input"><input type="text" id="crmInstall"></div>
        </div>
        <div class="form-row">
          <div class="form-cell label">叫修單號</div>
          <div class="form-cell input"><input type="text" id="repairNo"></div>
          <div class="form-cell label">CRM維修單號</div>
          <div class="form-cell input"><input type="text" id="crmRepair"></div>
        </div>
        <div class="form-row">
          <div class="form-cell label">客戶名稱</div>
          <div class="form-cell input" colspan="3"><input type="text" id="customerName"></div>
        </div>
        <div class="form-row no-print">
          <div class="form-cell label">EMAIL</div>
          <div class="form-cell input" colspan="3"><input type="email" id="email"></div>
        </div>
        <div class="form-row">
          <div class="form-cell label">地址</div>
          <div class="form-cell input" colspan="3"><input type="text" id="address"></div>
        </div>
        <div class="form-row">
          <div class="form-cell label">連絡人</div>
          <div class="form-cell input"><input type="text" id="contactPerson"></div>
          <div class="form-cell label">電話</div>
          <div class="form-cell input"><input type="text" id="phone"></div>
        </div>
        <div class="form-row">
          <div class="form-cell label">服務日期</div>
          <div class="form-cell input"><input type="date" id="serviceDate"></div>
          <div class="form-cell label">到達時間</div>
          <div class="form-cell input"><input type="time" id="arrival"></div>
          <div class="form-cell label">結束時間</div>
          <div class="form-cell input"><input type="time" id="finish"></div>
        </div>
      </div>

      <!-- 服務方式 -->
      <div class="section-title">服務方式</div>
      <div class="section-content">
        <div class="service-methods">
          <label class="checkbox-group"><input type="checkbox">場勘</label>
          <label class="checkbox-group"><input type="checkbox">POC</label>
          <label class="checkbox-group"><input type="checkbox">簡報</label>
          <label class="checkbox-group"><input type="checkbox">安裝</label>
          <label class="checkbox-group"><input type="checkbox">驗收</label>
          <label class="checkbox-group"><input type="checkbox">檢修</label>
          <label class="checkbox-group"><input type="checkbox">交貨</label>
          <label class="checkbox-group"><input type="checkbox">客戶需求訪談</label>
          <label class="checkbox-group"><input type="checkbox">DEMO產品展示</label>
          <label class="checkbox-group"><input type="checkbox">教育訓練</label>
          <label class="checkbox-group"><input type="checkbox">移機服務</label>
          <label class="checkbox-group"><input type="checkbox">會議支援</label>
          <label class="checkbox-group"><input type="checkbox">其他</label>
        </div>
      </div>

      <!-- 服務產品 -->
      <div class="section-title">服務產品</div>
      <div class="section-content">
        <table class="product-table">
          <thead>
            <tr><th>廠牌</th><th>型號</th><th>版本</th><th>序號</th></tr>
          </thead>
          <tbody>
            <tr><td><input></td><td><input></td><td><input></td><td><input></td></tr>
            <tr><td><input></td><td><input></td><td><input></td><td><input></td></tr>
            <tr><td><input></td><td><input></td><td><input></td><td><input></td></tr>
          </tbody>
        </table>
      </div>

      <!-- 服務內容 -->
      <div class="section-title">服務內容</div>
      <div class="section-content"><textarea rows="4"></textarea></div>

      <!-- 客戶意見 -->
      <div class="section-title">客戶意見</div>
      <div class="section-content"><textarea rows="4"></textarea></div>

      <!-- 簽名區 -->
      <div class="signature-section">
        <div class="signature-row">
          <div class="signature-box">
            主管簽名
            <canvas class="signature-canvas" id="managerSignature"></canvas>
            <div class="signature-controls no-print"><button type="button" class="clear-btn" onclick="clearSignature(managerPad)">清除</button></div>
          </div>
          <div class="signature-box">
            工程師簽名
            <canvas class="signature-canvas" id="engineerSignature"></canvas>
            <div class="signature-controls no-print"><button type="button" class="clear-btn" onclick="clearSignature(engineerPad)">清除</button></div>
          </div>
          <div class="signature-box">
            客戶簽名
            <canvas class="signature-canvas" id="customerSignature"></canvas>
            <div class="signature-controls no-print"><button type="button" class="clear-btn" onclick="clearSignature(customerPad)">清除</button></div>
          </div>
        </div>
      </div>

      <!-- 費用申請 -->
      <div class="section-title">費用申請：(以下由工程師收回單據後填寫申請)</div>
      <div class="section-content">
        <div class="expense-grid">
          <div class="expense-item"><label>里程 (KM)</label><input></div>
          <div class="expense-item"><label>出發地點</label><input></div>
          <div class="expense-item"><label>計程車資</label><input></div>
          <div class="expense-item"><label>停車費</label><input></div>
          <div class="expense-item"><label>eTag</label><input></div>
          <div class="expense-item"><label>大眾運輸</label><input></div>
          <div class="expense-item"><label>其他</label><input></div>
        </div>
      </div>
    </form>

    <div class="copy-info">
      白聯：工程師部門　紅聯：財務部（請款用）　黃聯：客戶收執
    </div>

    <div class="submit-section no-print">
      <button type="button" class="submit-btn" onclick="generatePDF()">📄 產生PDF並送出EMAIL</button>
    </div>
  </div>

  <script>
    let managerPad, engineerPad, customerPad;
    window.onload = function() {
      managerPad = new SignaturePad(document.getElementById('managerSignature'));
      engineerPad = new SignaturePad(document.getElementById('engineerSignature'));
      customerPad = new SignaturePad(document.getElementById('customerSignature'));
    }
    function clearSignature(pad) { pad.clear(); }

    async function generatePDF() {
      const element = document.getElementById('pdfContent');
      const canvas = await html2canvas(element, { scale:2 });
      const imgData = canvas.toDataURL('image/png');
      const pdf = new jspdf.jsPDF('p','mm','a4');
      const pdfW = pdf.internal.pageSize.getWidth();
      const pdfH = pdf.internal.pageSize.getHeight();
      pdf.addImage(imgData,'PNG',0,0,pdfW,pdfH);
      pdf.save('service-record.pdf');
    }
  </script>
</body>
</html>
